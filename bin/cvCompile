#!/bin/bash

function listParts
{
    ls -1 | sort
}

function getFilesFromList
{
    fileName="$1"

    grep -v '^\(\|#.*\)$' "$fileName"
}

function doCompile
{
    name="$1"
    variantFile="cvData/variant/$name.txt"
    outFile="compiled/$name.md"

    if [ ! -e "$variantFile" ]; then
        echo "Could not find variant \"$name\" in \"$variantFile\" from \"$(pwd)\"."
        exit 1
    fi

    cd cvData

    echo "Compiling \"$name\"."
    rm -f "$outFile"
    touch "$outFile"
    while read file; do
        cat "$file" >> "$outFile"
    done < <(getFilesFromList "../$variantFile")

    cd ..
}


if [ "$1" == '' ]; then
    while read variant; do
        doCompile "$variant"
    done < <(cvList)
else
    doCompile "$1"
fi
